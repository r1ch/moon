(function(t){function n(n){for(var i,r,s=n[0],c=n[1],l=n[2],u=0,h=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&h.push(o[r][0]),o[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);d&&d(n);while(h.length)h.shift()();return a.push.apply(a,l||[]),e()}function e(){for(var t,n=0;n<a.length;n++){for(var e=a[n],i=!0,s=1;s<e.length;s++){var c=e[s];0!==o[c]&&(i=!1)}i&&(a.splice(n--,1),t=r(r.s=e[0]))}return t}var i={},o={app:0},a=[];function r(n){if(i[n])return i[n].exports;var e=i[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,r),e.l=!0,e.exports}r.m=t,r.c=i,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)r.d(e,i,function(n){return t[n]}.bind(null,i));return e},r.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="/moon/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=n,s=s.slice();for(var l=0;l<s.length;l++)n(s[l]);var d=c;a.push([0,"chunk-vendors"]),e()})({0:function(t,n,e){t.exports=e("56d7")},"034f":function(t,n,e){"use strict";var i=e("85ec"),o=e.n(i);o.a},"17fe":function(t,n,e){},"56d7":function(t,n,e){"use strict";e.r(n);e("e260"),e("e6cf"),e("cca6"),e("a79d");var i=e("2b0e"),o=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"app"}},[t._v(" "+t._s(this.now.toLocaleTimeString())),e("br"),e("table",[t._m(0),e("tr",[e("td",[t._v(" "+t._s(this.nextRise.time.toLocaleTimeString())),e("br"),e("small",[t._v(t._s(this.nextRise.time.getDate()==this.now.getDate()?"today":"tomorrow"))])]),e("td",[t._v(" "+t._s(this.nextSet.time.toLocaleTimeString())),e("br"),e("small",[t._v(t._s(this.nextSet.time.getDate()==this.now.getDate()?"today":"tomorrow"))])])])]),e("br"),t.deviceCoordinates.default?e("p",[t._v(" I've assumed you're in London "),e("br"),t.deviceCoordinates.error?t._e():e("a",{attrs:{href:"#"},on:{click:t.locate}},[t._v("Update location")])]):t._e(),t.deviceCoordinates.error?e("p",[t._v(t._s(t.deviceCoordinates.error))]):t._e(),t.deviceCoordinates.error||t.deviceCoordinates.default?t._e():e("p",[t._v(" Lat, Lng: "+t._s(Number(t.deviceCoordinates.latitude).toFixed(3))+", "+t._s(Number(t.deviceCoordinates.longitude).toFixed(3))+" "),e("br"),t._v(" Height above sea: "+t._s(Number(t.deviceCoordinates.altitude).toFixed(1))+"m ")]),e("br"),e("sky-component",{attrs:{now:t.now,angle:t.angle,illuminated:t.illuminated,times:t.times,currentPosition:t.currentPosition,waxWane:t.waxWane}})],1)},a=[function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("tr",[e("td",[t._v("Rise")]),e("td",[t._v("Set")])])}],r=(e("99af"),e("7db0"),e("2af1"),function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{attrs:{id:"d3"}},[e("div",{attrs:{id:"moon"}}),e("small",[t._v(t._s(t.phaseText)+" ("+t._s(Number(100*this.illuminated).toFixed(1))+"%)")]),e("div",{attrs:{id:"horizon"}})])])}),s=[],c=(e("a15b"),e("d81d"),e("13d5"),e("2909")),l=e("5698"),d={name:"sky-component",props:["now","angle","illuminated","times","currentPosition","waxWane"],data:function(){var t={top:20,left:20,right:20,bottom:20},n={width:200,height:200},e={width:n.width-t.left-t.right,height:n.height-t.top-t.bottom},i={radius:e.width/2};i.offset=[e.width/2-i.radius,0].join(",");var o={width:900,height:200},a={width:o.width-t.left-t.right,height:o.height-t.top-t.bottom},r={radius:10};return r.offset=[0,a.height/2].join(","),{moonFull:n,moonInner:n,moon:i,horizonFull:o,horizonInner:a,horizon:r,margin:t}},mounted:function(){this.moonSvg=l.select("#moon").append("svg").attr("width",this.moonFull.width).attr("height",this.moonFull.height).append("g").attr("transform","translate(".concat(this.margin.left,",").concat(this.margin.top,")")).append("g"),this.moonSvg.append("clipPath").attr("id","outer-clip").append("circle").attr("r",this.moon.radius).attr("cx",this.moon.radius).attr("cy",this.moon.radius),this.horizonSvg=l.select("#horizon").append("svg").attr("width",this.horizonFull.width).attr("height",this.horizonFull.height).append("g").attr("transform","translate(".concat(this.margin.left,",").concat(this.margin.top,")")).append("g").attr("transform","translate(".concat(this.horizon.offset,")"));var t=this.moonSvg.append("defs"),n=t.append("filter").attr("id","glow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");n.append("feGaussianBlur").attr("stdDeviation",1).attr("result","moonDark"),n.append("feGaussianBlur").attr("stdDeviation",12).attr("result","moonShine");var e=n.append("feMerge");e.append("feMergeNode").attr("in","moonDark"),e.append("feMergeNode").attr("in","moonShine"),e.append("feMergeNode").attr("in","SourceGraphic"),this.draw()},watch:{now:function(){this.draw()}},computed:{phaseText:function(){var t=this.waxWane<0?this.illuminated/2:(2-this.illuminated)/2;return[{index:.01,text:"New Moon"},{index:.249,text:"Waxing Crescent"},{index:.251,text:"First Quarter"},{index:.499,text:"Waxing Gibbous"},{index:.501,text:"Full Moon"},{index:.749,text:"Waning Gibbous"},{index:.751,text:"Last Quarter"},{index:.99,text:"Waning Crescent"},{index:1,text:"New Moon"}].find((function(n){return t<n.index})).text},phase:function(){return 1-this.illuminated/2}},methods:{sweeps:function(t,n){var e={lit:["M ".concat(t," 0")],dark:["M ".concat(t," 0")]};return e.lit.push("a ".concat(t*(n<=.5?4*Math.abs(n-.25):1),", ").concat(t," 0 0 ").concat(n<=.25?1:0," 0,").concat(2*t)),e.lit.push("a ".concat(t*(n<=.5?1:4*Math.abs(n-.75)),", ").concat(t," 0 0 ").concat(n<=.75?0:1," 0,").concat(-2*t)),e.dark.push("a ".concat(t*(n<=.5?1:4*Math.abs(n-.75)),",").concat(t," 0 0 ").concat(n>.5&&n<=.75?1:0," 0,").concat(2*t)),e.dark.push("a ".concat(t*(n<=.5?4*Math.abs(n-.25):1),",").concat(t," 0 0 ").concat(n>=.25&&n<.5?1:0," 0,").concat(-2*t)),e},draw:function(){var t=this,n=this.sweeps(this.moon.radius,this.phase),e=this.sweeps(this.horizon.radius,this.phase);this.moonSvg.attr("transform","translate(".concat(this.moon.offset,") rotate(").concat(this.angle," ").concat(this.moon.radius,", ").concat(this.moon.radius,")")),this.moonSvg.selectAll(".moonborder").data([1]).join((function(n){return n.append("circle").attr("class","moonborder").attr("r",t.moon.radius).attr("cx",t.moon.radius).attr("cy",t.moon.radius)})),this.moonSvg.selectAll(".moonlit").data([1]).join((function(t){return t.append("path").attr("class","moonlit").attr("clip-path","url(#outer-clip)")})).attr("d","".concat(n.lit.join(" "))),this.moonSvg.selectAll(".moondark").data([1]).join((function(t){return t.append("path").attr("class","moondark").attr("clip-path","url(#outer-clip)")})).attr("d","".concat(n.dark.join(" "))).style("filter","url(#glow)");var i=l.scaleTime().domain([this.times.detail[0].time,this.times.detail[this.times.detail.length-1].time]).range([0,this.horizonInner.width]),o=l.scaleLinear().domain([-1*this.times.absAlt,this.times.absAlt]).range([this.horizonInner.height/2,this.horizonInner.height/-2]),a=l.axisBottom().scale(i),r=l.line().x((function(t){return i(t.time)})).y((function(t){return o(t.position.alt)})),s=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW","N"],d=s.map((function(t,n){return{point:t,az:2*(n/(s.length-1)-.5)*Math.PI}})),u=function(t){return d.reduce((function(n,e){return Math.abs(e.az-t.az)<Math.abs(n.az-t.az)?e:n}),d[0])};this.horizonSvg.selectAll(".cardinal").data([].concat(Object(c["a"])(this.times.rise),Object(c["a"])(this.times.set))).join((function(t){return t.append("text").attr("class","cardinal").call((function(t){return t.append("tspan").attr("class","cardinaltime").attr("dy","1em")})).call((function(t){return t.append("tspan").attr("class","cardinalposition").attr("dy","1em")}))})).attr("y",this.horizonInner.height/-4),this.horizonSvg.selectAll(".cardinaltime").data([].concat(Object(c["a"])(this.times.rise),Object(c["a"])(this.times.set))).text((function(t){return t.time.toLocaleTimeString()})).attr("x",(function(t){return i(t.time)})),this.horizonSvg.selectAll(".cardinalposition").data([].concat(Object(c["a"])(this.times.rise),Object(c["a"])(this.times.set))).text((function(t){return u(t.position).point})).attr("x",(function(t){return i(t.time)})),this.horizonSvg.selectAll(".axis").data([1]).join((function(t){return t.append("g").attr("class","axis")})).call(a),this.horizonSvg.selectAll(".axislabel").data(["horizon"]).join((function(t){return t.append("text").attr("class","axislabel").text((function(t){return t})).attr("dy",-1)})),this.horizonSvg.selectAll(".risePath").data([this.times.detail]).join((function(t){return t.append("path").attr("class","risePath")})).attr("d",(function(t){return r(t)})),this.horizonSvg.selectAll(".tinydark").data([1]).join((function(t){return t.append("path").attr("class","tinydark")})).attr("d","".concat(e.dark.join(" "))).attr("transform","translate(".concat(i(this.now)-this.horizon.radius,",").concat(o(this.currentPosition.alt)-this.horizon.radius,"),rotate(").concat(this.angle,",").concat(this.horizon.radius,",").concat(this.horizon.radius,")")),this.horizonSvg.selectAll(".tinylit").data([1]).join((function(t){return t.append("path").attr("class","tinylit")})).attr("d","".concat(e.lit.join(" "))).attr("transform","translate(".concat(i(this.now)-this.horizon.radius,",").concat(o(this.currentPosition.alt)-this.horizon.radius,"),rotate(").concat(this.angle,",").concat(this.horizon.radius,",").concat(this.horizon.radius,")")),this.horizonSvg.selectAll(".tinycardinal").data([this.currentPosition]).join((function(t){return t.append("text").attr("class","tinycardinal")})).text((function(t){return u(t).point})).attr("x",i(this.now)).attr("y",(function(n){return o(n.alt)+2*t.horizon.radius}))}}},u=d,h=(e("5bd5"),e("2877")),p=Object(h["a"])(u,r,s,!1,null,null,null),m=p.exports,f=e("be43"),g={name:"App",components:{SkyComponent:m},data:function(){return{deviceCoordinates:{default:!0,error:!1,latitude:51.5074,longitude:.1278,altitude:0},day:(new Date).getDate(),now:new Date,waxWane:!1,midnight:!1}},created:function(){var t=this;this.midnight=this.calculateMidnight(),setInterval((function(){var n=new Date;n.getDate()!=t.day&&(t.day=n.getDate()),t.now=n}),1e3)},watch:{day:function(){this.midnight=this.calculateMidnight()},illuminated:function(t,n){t&&n&&(this.waxWane=t>n?-1:1)}},methods:{calculateMidnight:function(){return console.log("Update to midnight"),{previous:new Date(this.now.getFullYear(),this.now.getMonth(),this.now.getDate(),0,0,0).getTime(),next:new Date(this.now.getFullYear(),this.now.getMonth(),this.now.getDate()+2,0,0,0).getTime()}},getTimesFor:function(){},locate:function(){var t=this;navigator.geolocation.getCurrentPosition((function(n){console.log(n),t.deviceCoordinates.latitude=n.coords.latitude,t.deviceCoordinates.longitude=n.coords.longitude,t.deviceCoordinates.altitude=n.coords.altitude||0,t.deviceCoordinates.default=!1}),(function(n){t.deviceCoordinates.error=n.message}),{maximumAge:5e4,timeout:2e4})}},computed:{jdo:function(){return new f.JulianDay(this.now)},astronomicalCoordinates:function(){return f.EclCoord.fromWgs84(this.deviceCoordinates.latitude,this.deviceCoordinates.longitude,this.deviceCoordinates.altitide)},sunTopocentricPosition:function(){return f.Solar.apparentTopocentric(this.jdo,this.astronomicalCoordinates)},moonTopocentricPosition:function(){return f.Moon.topocentricPosition(this.jdo,this.astronomicalCoordinates)},phase:function(){return f.MoonIllum.phaseAngleEq2(this.moonTopocentricPosition.eq,this.sunTopocentricPosition)},illuminated:function(){return f.MoonIllum.illuminated(this.phase)},angle:function(){var t=f.MoonIllum.positionAngle(this.moonTopocentricPosition.eq,this.sunTopocentricPosition);return(t-this.moonTopocentricPosition.q)/Math.PI*-180+90},currentPosition:function(){return f.Moon.topocentricPosition(this.jdo,this.astronomicalCoordinates).hz},nextRise:function(){var t=this;return this.times.rise.find((function(n){return n.time.getTime()>t.now.getTime()}))},nextSet:function(){var t=this;return this.times.set.find((function(n){return n.time.getTime()>t.now.getTime()}))},times:function(){for(var t=18e4,n=1e3,e={absAlt:0,rise:[],set:[],detail:[]},i=0,o=[this.midnight.previous,t,!1,0],a=o[0],r=o[1],s=o[2];a<=this.midnight.next;a+=r){i++;var c=new Date(a),l=f.Moon.topocentricPosition(new f.JulianDay(c),this.astronomicalCoordinates).hz,d={time:c,position:l};if(s&&Math.sign(s.alt)!=Math.sign(l.alt)){if(r==t){console.log("Crossed ".concat(c,", ").concat(r)),a-=r,r=n,a+=r,console.log("Crossed ".concat(c,", ").concat(r));continue}console.log("Crossed ".concat(c,", ").concat(r)),l.alt>0?e.rise.push(d):e.set.push(d),r=t,a-=a%r,console.log("Crossed ".concat(c,", ").concat(r))}s=l,e.absAlt=Math.max(e.absAlt,Math.abs(l.alt)),e.detail.push(d)}return console.log(i),e}}},v=g,w=(e("034f"),Object(h["a"])(v,o,a,!1,null,null,null)),x=w.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(x)}}).$mount("#app")},"5bd5":function(t,n,e){"use strict";var i=e("17fe"),o=e.n(i);o.a},"85ec":function(t,n,e){}});
//# sourceMappingURL=app.b1a80358.js.map